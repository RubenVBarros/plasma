<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Plasma - Echelle de l'univers</title>
  <link type="text/css" rel="stylesheet" href="menu.css">
</head>
  <script src="pixi/pixi.min.js"></script>
  <style>
      *{padding:0;margin: 0;}
  </style>
<body>
    <div class="slidecontainer">
        <input type="range" min="-10" max="12" value="1" step="0.000001" class="slider" id="ma-range">
    </div>
  <script type="text/javascript">
    //Si le navigateur ne prend pas en charge WebGL il utilise alors un Canvas à la place du renderer
    let type = "WebGL"
    if(!PIXI.utils.isWebGLSupported()){
      type = "canvas"
    }
    class Pictures{
        constructor(container,images,tailleReelle,angle,message){
            this.container = container;
            this.images = images;
            this.tailleReelle = tailleReelle;
            this.angle = angle;
            this.message = message;
        }
        placement(){
            //Variable qui récupère la valuer du slider qui permettra de faire les calculs
            let curseur = Math.pow(10,slider.value);

            //Varible qui permet de faire les calculs pour la position et pour le calcul du ratio
            let ratio, ratioTaille, largeur, hauteur, positionX, positionY;
            ratio = this.tailleReelle / curseur;
            if (ratio < 10) 
            { 
                ratioTaille = tailleRef/(Math.max(this.container.width, this.container.height));	
                largeur = this.container.width * ratio * ratioTaille;
                hauteur = this.container.height * ratio * ratioTaille;
                positionX = (centreX) + (ratio*rayon*Math.cos(this.angle));
                positionY = (app.view.height/2) + (ratio*rayon*Math.sin(this.angle));
                this.container.x = centreX;
                this.container.y = positionY - hauteur/2;
                this.container.width = largeur;
                this.container.height = hauteur;
            }
        }
    }
    //Initailisation de l'app et des variables pour les sprites et les graphiques et autres... 
    let app = new PIXI.Application({width: 2133, height: 1118, antialias:true,transparent:false,resolution:1}),
    Sprite = PIXI.Sprite,
    loader = PIXI.loader,
    graphics  = PIXI.Graphics,
    txtp = PIXI.Text,
    txts = PIXI.TextStyle,
    resources = PIXI.Loader.resources;

    //Style pour le message
    let style = new txts({
        fontFamily: "Arial",
        fontSize: 30,
        fill: "black",
      });

    //Le canvas prend l'entiereté de la fenêtre et se resize automatiquement, selon le redimensionnement de la fenêtre
    app.renderer.autoResize = true;
    app.renderer.view.style.position = "absolute";
    app.renderer.view.style.display = "block";
    app.renderer.resize(window.innerWidth, window.innerHeight);
    app.renderer.backgroundColor = 0xF9F2FB;
   
    //Le canvas est ajouté dans l'app directement
    document.body.appendChild(app.view);

    //on fait un container par objet
    let cont = new Pictures(new PIXI.Container,new PIXI.Sprite.from("assets/cristal.png"),1,Math.PI/8,new txtp("Molécule de cristal",style));
    //let cont = new PIXI.Container();
    let con = new Pictures(new PIXI.Container,new PIXI.Sprite.from("assets/bus.png"),12,Math.PI/6,new txtp("Bus",style));
    let abc = new PIXI.Container();

    //Initialisation du tableau d'objets et ajout des objets
    let tab = [];
    tab.push(cont,con);

    //On charge un sprite de l'atome de cristal et on le positionne au milieu de l'écran.
    //let player = new Sprite.from("assets/cristal.png");
    cont.images.x = app.view.width/2;
    cont.images.y = app.view.height/2;
    cont.images.buttonMode = true;
    cont.images.interactive = true;
    con.images.x = app.view.width/2;
    con.images.y = app.view.height/2;
    con.images.buttonMode = true;
    con.images.interactive = true;

      //Position du nom de l'objet
      cont.message.position.set(cont.images.x+1360, cont.images.y+1240);
      con.message.position.set(con.images.x+1360, con.images.y+1240);

      //Ajout de images et du message ds les containers d'un objet Pictures
      cont.container.addChild(cont.images,cont.message);
      con.container.addChild(con.images,con.message);

      //Ajout des containers des objets Pictures
      app.stage.addChild(cont.container,con.container,abc);

      //Ajout du slider 
      let slider = document.getElementById("ma-range");
      console.log(slider.value);

      //Variable générale qui donne l'effet de zoom
      let tailleRef = 3779;
      let rayon = 1500;
      let centreX = 100;

      //Initialisation du message de la puissance comme du texte 
      let powmess = new PIXI.Text();

    //Lorsque que l'on clique sur l'objet un rectangle apparait et l'on peut voir la description
    cont.images.on('mousedown',function(e){
        alert("Un atome de cristal est très petit de l'ordre de 10^9 à 10^10");
        let r = new graphics();
        r.lineStyle(4, 0x000000, 1);
        r.beginFill(0xFFFFFF);
        r.drawRoundedRect(0, 0, 200, 200, 10);
        r.x = cont.images.x+2600;
        r.y = cont.images.y+570;
        r.width = 2500;
        r.height = 2500;
        cont.container.addChild(r);
        cont.images.on('mouseout',function(event){
            r.visible = false;
        });
    });
    con.images.on('mousedown',function(e){
        alert('Voici le scientibus, celui dans lequel vous êtes, il fait plus de 12 mètres, pas mal grand le bus hein ?')
    })
    //On console log la valeur quand on arrete de cliquer sur le slider
    slider.addEventListener('click',function(e){
            console.log(slider.value);
    });

    /*On affecte la fonction de zoom à l'action de scroll dans la page
    document.body.onwheel = function(){scrollZoom(event)};
    //Fonction de scroll sur l'objet pour obtenir l'effet zoom
    function scrollZoom(event){
        if(event.deltaY > 0){
            for(let i = 0;i < 500;i++){
                cont.width -= 0.1; 
                cont.height -= 0.1;
                cont.x += 0.05;
                cont.y += 0.05;
                con.width -= 0.1; 
                con.height -= 0.1;
                con.x += 0.05;
                con.y += 0.05;
                abc.width -= 0.1; 
                abc.height -= 0.1;
                abc.x += 0.05;
                abc.y += 0.05;
            }
        }
        else{
            for(let i = 0;i < 500;i++){
                cont.width += 0.1; 
                cont.height += 0.1;
                cont.x -= 0.05;
                cont.y -= 0.05;
                con.width += 0.1; 
                con.height += 0.1;
                con.x -= 0.05;
                con.y -= 0.05;
                abc.width += 0.1; 
                abc.height += 0.1;
                abc.x -= 0.05;
                abc.y -= 0.05;
            }
        }
    }*/

    //On initialise l'état d'animation
    //Le state est alors un composant qui permet de faire tourner à 60 FPS l'animation
    state = draw;
    
    //On ajout la fonction pour la boucle et on l'a commence
    app.ticker.add(delta => loop(delta));
    app.ticker.start();

    //Boucle d'animation
    function loop(delta){
        state(delta)
    }

    //La fonction play permet alors de voir l'animation grâce à la boucle
    function draw(delta){
        //Variable pour recolorier l'écran à chaque frame
        app.renderer.backgroundColor = 0xFFFFFF;

        //Optimiser avec un boucle sur les objets grace aux tableaux des objets 
        //On veut chaques nom d'objet par rapport à son [i] 
        //Ex: Si le tableau comporte 3 objets donc 3 images et 3 containers, alors on boucle sur le tab et on va mettre i < tab.length et aussi on va mettre
        //Ce que l'on veut c'est à chaque [i] le nom de l'objet.placement();

        //Fonction de la classe qui permet de voir l'animation
        //cont.placement();
        for(let i = 0;i < tab.length;i++){
            tab[i].placement();
        }

        //Ajout du texte qui indique la puissance en cours sur le slider, puis positionnement du slider et ajout la scène de l'application
        powmess = new txtp("10^"+slider.value);
        powmess.position.set(0, 0);
        app.stage.addChild(powmess);
    }
  </script>
</body>
</html>